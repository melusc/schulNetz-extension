(()=>{"use strict";var __webpack_exports__={};function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var n,l,u,i,t,r,o={},f=[],e=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function c(n,l){for(var u in l)n[u]=l[u];return n}function s(n){var l=n.parentNode;l&&l.removeChild(n)}function a(n,l,u){var i,t,r,o=arguments,f={};for(r in l)"key"==r?i=l[r]:"ref"==r?t=l[r]:f[r]=l[r];if(arguments.length>3)for(u=[u],r=3;r<arguments.length;r++)u.push(o[r]);if(null!=u&&(f.children=u),"function"==typeof n&&null!=n.defaultProps)for(r in n.defaultProps)void 0===f[r]&&(f[r]=n.defaultProps[r]);return v(n,f,i,t,null)}function v(l,u,i,t,r){var o={type:l,props:u,key:i,ref:t,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==r?++n.__v:r};return null!=n.vnode&&n.vnode(o),o}function h(){return{current:null}}function y(n){return n.children}function p(n,l){this.props=n,this.context=l}function d(n,l){if(null==l)return n.__?d(n.__,n.__.__k.indexOf(n)+1):null;for(var u;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e)return u.__e;return"function"==typeof n.type?d(n):null}function _(n){var l,u;if(null!=(n=n.__)&&null!=n.__c){for(n.__e=n.__c.base=null,l=0;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e){n.__e=n.__c.base=u.__e;break}return _(n)}}function k(l){(!l.__d&&(l.__d=!0)&&u.push(l)&&!m.__r++||t!==n.debounceRendering)&&((t=n.debounceRendering)||i)(m)}function m(){for(var n;m.__r=u.length;)n=u.sort((function(n,l){return n.__v.__b-l.__v.__b})),u=[],n.some((function(n){var l,u,i,t,r,o;n.__d&&(r=(t=(l=n).__v).__e,(o=l.__P)&&(u=[],(i=c({},t)).__v=t.__v+1,T(o,t,i,l.__n,void 0!==o.ownerSVGElement,null!=t.__h?[r]:null,u,null==r?d(t):r,t.__h),j(u,t),t.__e!=r&&_(t)))}))}function b(n,l,u,i,t,r,e,c,s,a){var h,p,_,k,m,b,w,A=i&&i.__k||f,P=A.length;for(u.__k=[],h=0;h<l.length;h++)if(null!=(k=u.__k[h]=null==(k=l[h])||"boolean"==typeof k?null:"string"==typeof k||"number"==typeof k?v(null,k,null,null,k):Array.isArray(k)?v(y,{children:k},null,null,null):k.__b>0?v(k.type,k.props,k.key,null,k.__v):k)){if(k.__=u,k.__b=u.__b+1,null===(_=A[h])||_&&k.key==_.key&&k.type===_.type)A[h]=void 0;else for(p=0;p<P;p++){if((_=A[p])&&k.key==_.key&&k.type===_.type){A[p]=void 0;break}_=null}T(n,k,_=_||o,t,r,e,c,s,a),m=k.__e,(p=k.ref)&&_.ref!=p&&(w||(w=[]),_.ref&&w.push(_.ref,null,k),w.push(p,k.__c||m,k)),null!=m?(null==b&&(b=m),"function"==typeof k.type&&null!=k.__k&&k.__k===_.__k?k.__d=s=g(k,s,n):s=x(n,k,_,A,m,s),a||"option"!==u.type?"function"==typeof u.type&&(u.__d=s):n.value=""):s&&_.__e==s&&s.parentNode!=n&&(s=d(_))}for(u.__e=b,h=P;h--;)null!=A[h]&&("function"==typeof u.type&&null!=A[h].__e&&A[h].__e==u.__d&&(u.__d=d(i,h+1)),L(A[h],A[h]));if(w)for(h=0;h<w.length;h++)I(w[h],w[++h],w[++h])}function g(n,l,u){var i,t;for(i=0;i<n.__k.length;i++)(t=n.__k[i])&&(t.__=n,l="function"==typeof t.type?g(t,l,u):x(u,t,t,n.__k,t.__e,l));return l}function w(n,l){return l=l||[],null==n||"boolean"==typeof n||(Array.isArray(n)?n.some((function(n){w(n,l)})):l.push(n)),l}function x(n,l,u,i,t,r){var o,f,e;if(void 0!==l.__d)o=l.__d,l.__d=void 0;else if(null==u||t!=r||null==t.parentNode)n:if(null==r||r.parentNode!==n)n.appendChild(t),o=null;else{for(f=r,e=0;(f=f.nextSibling)&&e<i.length;e+=2)if(f==t)break n;n.insertBefore(t,r),o=r}return void 0!==o?o:t.nextSibling}function A(n,l,u,i,t){var r;for(r in u)"children"===r||"key"===r||r in l||C(n,r,null,u[r],i);for(r in l)t&&"function"!=typeof l[r]||"children"===r||"key"===r||"value"===r||"checked"===r||u[r]===l[r]||C(n,r,l[r],u[r],i)}function P(n,l,u){"-"===l[0]?n.setProperty(l,u):n[l]=null==u?"":"number"!=typeof u||e.test(l)?u:u+"px"}function C(n,l,u,i,t){var r;n:if("style"===l)if("string"==typeof u)n.style.cssText=u;else{if("string"==typeof i&&(n.style.cssText=i=""),i)for(l in i)u&&l in u||P(n.style,l,"");if(u)for(l in u)i&&u[l]===i[l]||P(n.style,l,u[l])}else if("o"===l[0]&&"n"===l[1])r=l!==(l=l.replace(/Capture$/,"")),l=l.toLowerCase()in n?l.toLowerCase().slice(2):l.slice(2),n.l||(n.l={}),n.l[l+r]=u,u?i||n.addEventListener(l,r?H:$,r):n.removeEventListener(l,r?H:$,r);else if("dangerouslySetInnerHTML"!==l){if(t)l=l.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==l&&"list"!==l&&"form"!==l&&"download"!==l&&l in n)try{n[l]=null==u?"":u;break n}catch(n){}"function"==typeof u||(null!=u&&(!1!==u||"a"===l[0]&&"r"===l[1])?n.setAttribute(l,u):n.removeAttribute(l))}}function $(l){this.l[l.type+!1](n.event?n.event(l):l)}function H(l){this.l[l.type+!0](n.event?n.event(l):l)}function T(l,u,i,t,r,o,f,e,s){var a,v,h,d,_,k,m,g,w,x,A,P=u.type;if(void 0!==u.constructor)return null;null!=i.__h&&(s=i.__h,e=u.__e=i.__e,u.__h=null,o=[e]),(a=n.__b)&&a(u);try{n:if("function"==typeof P){if(g=u.props,w=(a=P.contextType)&&t[a.__c],x=a?w?w.props.value:a.__:t,i.__c?m=(v=u.__c=i.__c).__=v.__E:("prototype"in P&&P.prototype.render?u.__c=v=new P(g,x):(u.__c=v=new p(g,x),v.constructor=P,v.render=M),w&&w.sub(v),v.props=g,v.state||(v.state={}),v.context=x,v.__n=t,h=v.__d=!0,v.__h=[]),null==v.__s&&(v.__s=v.state),null!=P.getDerivedStateFromProps&&(v.__s==v.state&&(v.__s=c({},v.__s)),c(v.__s,P.getDerivedStateFromProps(g,v.__s))),d=v.props,_=v.state,h)null==P.getDerivedStateFromProps&&null!=v.componentWillMount&&v.componentWillMount(),null!=v.componentDidMount&&v.__h.push(v.componentDidMount);else{if(null==P.getDerivedStateFromProps&&g!==d&&null!=v.componentWillReceiveProps&&v.componentWillReceiveProps(g,x),!v.__e&&null!=v.shouldComponentUpdate&&!1===v.shouldComponentUpdate(g,v.__s,x)||u.__v===i.__v){v.props=g,v.state=v.__s,u.__v!==i.__v&&(v.__d=!1),v.__v=u,u.__e=i.__e,u.__k=i.__k,v.__h.length&&f.push(v);break n}null!=v.componentWillUpdate&&v.componentWillUpdate(g,v.__s,x),null!=v.componentDidUpdate&&v.__h.push((function(){v.componentDidUpdate(d,_,k)}))}v.context=x,v.props=g,v.state=v.__s,(a=n.__r)&&a(u),v.__d=!1,v.__v=u,v.__P=l,a=v.render(v.props,v.state,v.context),v.state=v.__s,null!=v.getChildContext&&(t=c(c({},t),v.getChildContext())),h||null==v.getSnapshotBeforeUpdate||(k=v.getSnapshotBeforeUpdate(d,_)),A=null!=a&&a.type===y&&null==a.key?a.props.children:a,b(l,Array.isArray(A)?A:[A],u,i,t,r,o,f,e,s),v.base=u.__e,u.__h=null,v.__h.length&&f.push(v),m&&(v.__E=v.__=null),v.__e=!1}else null==o&&u.__v===i.__v?(u.__k=i.__k,u.__e=i.__e):u.__e=z(i.__e,u,i,t,r,o,f,s);(a=n.diffed)&&a(u)}catch(l){u.__v=null,(s||null!=o)&&(u.__e=e,u.__h=!!s,o[o.indexOf(e)]=null),n.__e(l,u,i)}}function j(l,u){n.__c&&n.__c(u,l),l.some((function(u){try{l=u.__h,u.__h=[],l.some((function(n){n.call(u)}))}catch(l){n.__e(l,u.__v)}}))}function z(n,l,u,i,t,r,e,c){var a,v,h,y,p=u.props,d=l.props,_=l.type,k=0;if("svg"===_&&(t=!0),null!=r)for(;k<r.length;k++)if((a=r[k])&&(a===n||(_?a.localName==_:3==a.nodeType))){n=a,r[k]=null;break}if(null==n){if(null===_)return document.createTextNode(d);n=t?document.createElementNS("http://www.w3.org/2000/svg",_):document.createElement(_,d.is&&d),r=null,c=!1}if(null===_)p===d||c&&n.data===d||(n.data=d);else{if(r=r&&f.slice.call(n.childNodes),v=(p=u.props||o).dangerouslySetInnerHTML,h=d.dangerouslySetInnerHTML,!c){if(null!=r)for(p={},y=0;y<n.attributes.length;y++)p[n.attributes[y].name]=n.attributes[y].value;(h||v)&&(h&&(v&&h.__html==v.__html||h.__html===n.innerHTML)||(n.innerHTML=h&&h.__html||""))}if(A(n,d,p,t,c),h)l.__k=[];else if(k=l.props.children,b(n,Array.isArray(k)?k:[k],l,u,i,t&&"foreignObject"!==_,r,e,n.firstChild,c),null!=r)for(k=r.length;k--;)null!=r[k]&&s(r[k]);c||("value"in d&&void 0!==(k=d.value)&&(k!==n.value||"progress"===_&&!k)&&C(n,"value",k,p.value,!1),"checked"in d&&void 0!==(k=d.checked)&&k!==n.checked&&C(n,"checked",k,p.checked,!1))}return n}function I(l,u,i){try{"function"==typeof l?l(u):l.current=u}catch(l){n.__e(l,i)}}function L(l,u,i){var t,r,o;if(n.unmount&&n.unmount(l),(t=l.ref)&&(t.current&&t.current!==l.__e||I(t,null,u)),i||"function"==typeof l.type||(i=null!=(r=l.__e)),l.__e=l.__d=void 0,null!=(t=l.__c)){if(t.componentWillUnmount)try{t.componentWillUnmount()}catch(l){n.__e(l,u)}t.base=t.__P=null}if(t=l.__k)for(o=0;o<t.length;o++)t[o]&&L(t[o],u,i);null!=r&&s(r)}function M(n,l,u){return this.constructor(n,u)}function N(l,u,i){var t,r,e;n.__&&n.__(l,u),r=(t="function"==typeof i)?null:i&&i.__k||u.__k,e=[],T(u,l=(!t&&i||u).__k=a(y,null,[l]),r||o,o,void 0!==u.ownerSVGElement,!t&&i?[i]:r?null:u.firstChild?f.slice.call(u.childNodes):null,e,!t&&i?i:r?r.__e:u.firstChild,t),j(e,l)}function O(n,l){N(n,l,O)}function S(n,l,u){var i,t,r,o=arguments,f=c({},n.props);for(r in l)"key"==r?i=l[r]:"ref"==r?t=l[r]:f[r]=l[r];if(arguments.length>3)for(u=[u],r=3;r<arguments.length;r++)u.push(o[r]);return null!=u&&(f.children=u),v(n.type,f,i||n.key,t||n.ref,null)}function q(n,l){var u={__c:l="__cC"+r++,__:n,Consumer:function(n,l){return n.children(l)},Provider:function(n){var u,i;return this.getChildContext||(u=[],(i={})[l]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(n){this.props.value!==n.value&&u.some(k)},this.sub=function(n){u.push(n);var l=n.componentWillUnmount;n.componentWillUnmount=function(){u.splice(u.indexOf(n),1),l&&l.call(n)}}),n.children}};return u.Provider.__=u.Consumer.contextType=u}n={__e:function(n,l){for(var u,i,t;l=l.__;)if((u=l.__c)&&!u.__)try{if((i=u.constructor)&&null!=i.getDerivedStateFromError&&(u.setState(i.getDerivedStateFromError(n)),t=u.__d),null!=u.componentDidCatch&&(u.componentDidCatch(n),t=u.__d),t)return u.__E=u}catch(l){n=l}throw n},__v:0},l=function(n){return null!=n&&void 0===n.constructor},p.prototype.setState=function(n,l){var u;u=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=c({},this.state),"function"==typeof n&&(n=n(c({},u),this.props)),n&&c(u,n),null!=n&&this.__v&&(l&&this.__h.push(l),k(this))},p.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),k(this))},p.prototype.render=y,u=[],i="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,m.__r=0,r=0;var EMPTY$1={};function preact_router_es_assign(obj,props){for(var i in props){obj[i]=props[i]}return obj}function exec(url,route,opts){var reg=/(?:\?([^#]*))?(#.*)?$/,c=url.match(reg),matches={},ret;if(c&&c[1]){var p=c[1].split("&");for(var i=0;i<p.length;i++){var r=p[i].split("=");matches[decodeURIComponent(r[0])]=decodeURIComponent(r.slice(1).join("="))}}url=segmentize(url.replace(reg,""));route=segmentize(route||"");var max=Math.max(url.length,route.length);for(var i$1=0;i$1<max;i$1++){if(route[i$1]&&route[i$1].charAt(0)===":"){var param=route[i$1].replace(/(^:|[+*?]+$)/g,""),flags=(route[i$1].match(/[+*?]+$/)||EMPTY$1)[0]||"",plus=~flags.indexOf("+"),star=~flags.indexOf("*"),val=url[i$1]||"";if(!val&&!star&&(flags.indexOf("?")<0||plus)){ret=false;break}matches[param]=decodeURIComponent(val);if(plus||star){matches[param]=url.slice(i$1).map(decodeURIComponent).join("/");break}}else if(route[i$1]!==url[i$1]){ret=false;break}}if(opts.default!==true&&ret===false){return false}return matches}function pathRankSort(a,b){return a.rank<b.rank?1:a.rank>b.rank?-1:a.index-b.index}function prepareVNodeForRanking(vnode,index){vnode.index=index;vnode.rank=rankChild(vnode);return vnode.props}function segmentize(url){return url.replace(/(^\/+|\/+$)/g,"").split("/")}function rankSegment(segment){return segment.charAt(0)==":"?1+"*+?".indexOf(segment.charAt(segment.length-1))||4:5}function rank(path){return segmentize(path).map(rankSegment).join("")}function rankChild(vnode){return vnode.props.default?0:rank(vnode.props.path)}var customHistory=null;var ROUTERS=[];var subscribers=[];var EMPTY={};function setUrl(url,type){if(type===void 0)type="push";if(customHistory&&customHistory[type]){customHistory[type](url)}else if(typeof history!=="undefined"&&history[type+"State"]){history[type+"State"](null,null,url)}}function getCurrentUrl(){var url;if(customHistory&&customHistory.location){url=customHistory.location}else if(customHistory&&customHistory.getCurrentLocation){url=customHistory.getCurrentLocation()}else{url=typeof location!=="undefined"?location:EMPTY}return""+(url.pathname||"")+(url.search||"")}function route(url,replace){if(replace===void 0)replace=false;if(typeof url!=="string"&&url.url){replace=url.replace;url=url.url}if(canRoute(url)){setUrl(url,replace?"replace":"push")}return routeTo(url)}function canRoute(url){for(var i=ROUTERS.length;i--;){if(ROUTERS[i].canRoute(url)){return true}}return false}function routeTo(url){var didRoute=false;for(var i=0;i<ROUTERS.length;i++){if(ROUTERS[i].routeTo(url)===true){didRoute=true}}for(var i$1=subscribers.length;i$1--;){subscribers[i$1](url)}return didRoute}function routeFromLink(node){if(!node||!node.getAttribute){return}var href=node.getAttribute("href"),target=node.getAttribute("target");if(!href||!href.match(/^\//g)||target&&!target.match(/^_?self$/i)){return}return route(href)}function handleLinkClick(e){if(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.button!==0){return}routeFromLink(e.currentTarget||e.target||this);return prevent(e)}function prevent(e){if(e){if(e.stopImmediatePropagation){e.stopImmediatePropagation()}if(e.stopPropagation){e.stopPropagation()}e.preventDefault()}return false}function delegateLinkHandler(e){if(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.button!==0){return}var t=e.target;do{if(String(t.nodeName).toUpperCase()==="A"&&t.getAttribute("href")){if(t.hasAttribute("native")){return}if(routeFromLink(t)){return prevent(e)}}}while(t=t.parentNode)}var eventListenersInitialized=false;function initEventListeners(){if(eventListenersInitialized){return}if(typeof addEventListener==="function"){if(!customHistory){addEventListener("popstate",(function(){routeTo(getCurrentUrl())}))}addEventListener("click",delegateLinkHandler)}eventListenersInitialized=true}var Router=function(Component$$1){function Router(props){Component$$1.call(this,props);if(props.history){customHistory=props.history}this.state={url:props.url||getCurrentUrl()};initEventListeners()}if(Component$$1)Router.__proto__=Component$$1;Router.prototype=Object.create(Component$$1&&Component$$1.prototype);Router.prototype.constructor=Router;Router.prototype.shouldComponentUpdate=function shouldComponentUpdate(props){if(props.static!==true){return true}return props.url!==this.props.url||props.onChange!==this.props.onChange};Router.prototype.canRoute=function canRoute(url){var children=w(this.props.children);return this.getMatchingChildren(children,url,false).length>0};Router.prototype.routeTo=function routeTo(url){this.setState({url});var didRoute=this.canRoute(url);if(!this.updating){this.forceUpdate()}return didRoute};Router.prototype.componentWillMount=function componentWillMount(){ROUTERS.push(this);this.updating=true};Router.prototype.componentDidMount=function componentDidMount(){var this$1=this;if(customHistory){this.unlisten=customHistory.listen((function(location){this$1.routeTo(""+(location.pathname||"")+(location.search||""))}))}this.updating=false};Router.prototype.componentWillUnmount=function componentWillUnmount(){if(typeof this.unlisten==="function"){this.unlisten()}ROUTERS.splice(ROUTERS.indexOf(this),1)};Router.prototype.componentWillUpdate=function componentWillUpdate(){this.updating=true};Router.prototype.componentDidUpdate=function componentDidUpdate(){this.updating=false};Router.prototype.getMatchingChildren=function getMatchingChildren(children,url,invoke){return children.filter(prepareVNodeForRanking).sort(pathRankSort).map((function(vnode){var matches=exec(url,vnode.props.path,vnode.props);if(matches){if(invoke!==false){var newProps={url,matches};preact_router_es_assign(newProps,matches);delete newProps.ref;delete newProps.key;return S(vnode,newProps)}return vnode}})).filter(Boolean)};Router.prototype.render=function render(ref,ref$1){var children=ref.children;var onChange=ref.onChange;var url=ref$1.url;var active=this.getMatchingChildren(w(children),url,true);var current=active[0]||null;var previous=this.previousUrl;if(url!==previous){this.previousUrl=url;if(typeof onChange==="function"){onChange({router:this,url,previous,active,current})}}return current};return Router}(p);var Link=function(props){return a("a",preact_router_es_assign({onClick:handleLinkClick},props))};var Route=function(props){return a(props.component,props)};Router.subscribers=subscribers;Router.getCurrentUrl=getCurrentUrl;Router.route=route;Router.Router=Router;Router.Route=Route;Router.Link=Link;Router.exec=exec;const preact_router_es=null&&Router;const ERRORS={INCORRECT_CREDS:"ERROR_INCORRECT_CREDS"};const login=async({url,username,password})=>{const loginhashRequest=await fetch(`https://www.schul-netz.com/${url}/loginto.php?mode=0&lang=`);if(!loginhashRequest.ok){throw loginhashRequest.statusText}const loginHashText=await loginhashRequest.text();console.log(loginHashText);const loginhash=(new DOMParser).parseFromString(loginHashText,"text/html").querySelector('input[name="loginhash"]');if(!loginhash){throw new Error("Failed to get hash from login page")}const loginRequestBody=new URLSearchParams({login:username,passwort:password,loginhash:loginhash.value}).toString();const marksPageRequest=await fetch(`https://www.schul-netz.com/${url}/index.php?pageid=21311`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:loginRequestBody});if(!marksPageRequest.ok){throw marksPageRequest.statusText}const marksPageURL=new URL(marksPageRequest.url);console.log(marksPageURL);if(marksPageURL.pathname!==`/${url}/index.php`){throw new Error(ERRORS.INCORRECT_CREDS)}const marksPageText=await marksPageRequest.text();const parsedMarksPage=(new DOMParser).parseFromString(marksPageText,"text/html");const marksTable=[...parsedMarksPage.querySelectorAll("h3")].find((element=>/aktuelle noten/i.test(element.textContent))).nextElementSibling.querySelector("table");return[...marksTable.rows].slice(1).filter((element=>element.style.display!=="none"&&Number.isFinite(Number.parseFloat(element.children[1].textContent.trim()))))};const script_login=login;const init=()=>{history.replaceState("",{},"/");N(a(Main,null),document.body)};const Main=()=>a(Router,null,a(Default,{path:"/"}),a(Settings,{path:"/settings"}));class Settings extends p{constructor(...args){super(...args);_defineProperty(this,"state",{});_defineProperty(this,"render",((_properties,{username,password,ignoring,url,validSaved,errorMsg})=>a("div",{class:"margin"},a("div",null,a("button",{type:"button",class:"btn",onClick:()=>{route("/")}},"Go back"),a("hr",null)),a("div",{onKeyDown:this.handleSave},a("div",{class:"input-wrapper"},a("div",null,"Username:"),a("input",{type:"text",placeholder:"Username",onInput:event_=>this.handleInput(event_,"username"),value:username})),a("div",{class:"input-wrapper"},a("div",null,"Password:"),a("input",{type:"password",placeholder:"Password",onInput:event_=>this.handleInput(event_,"password"),value:password})),a("div",{class:"input-wrapper"},a("div",null,"URL to schulNetz page"),a("p",null,a("small",null,"ausserschwyz, einsiedeln...")),a("input",{type:"text",placeholder:"url",onInput:event_=>this.handleInput(event_,"url"),value:url})),a("div",{class:"input-wrapper"},a("div",null,"Ignore specific courses"),a("p",null,a("small",null,"seperated by commas")),a("input",{type:"text",placeholder:"sport",onInput:event_=>this.handleInput(event_,"ignoring"),value:ignoring}))),errorMsg&&a("div",null,typeof errorMsg==="string"?errorMsg:errorMsg.message),a("hr",null),a("div",{class:"input-wrapper"},a("button",{onClick:this.handleSave,class:`btn${typeof validSaved==="boolean"?validSaved?" saved":" failed":""}`,onAnimationEnd:()=>this.setState({validSaved:undefined}),type:"button"},typeof validSaved==="boolean"?validSaved?"✓":"✗":"Saved")))));_defineProperty(this,"handleInput",((event_,type)=>{if(type==="password"){this.setState({[type]:event_.target.value})}else{this.setState({[type]:event_.target.value.trim()})}this.setState({errorMsg:undefined})}));_defineProperty(this,"handleSave",(event=>{if(event.type==="click"||event.type==="keydown"&&event.key==="Enter"){chrome.storage.local.get(["url","password","username"],(({password:origPassword,username:origUsername,url:origUrl})=>{const{password}=this.state;const url=this.state.url.trim();const username=this.state.username.trim();const ignoring=this.state.ignoring.split(",").map((item=>item.trim().toLowerCase())).filter((item=>item));if(password===origPassword&&username===origUsername&&origUrl===url){chrome.storage.local.set({ignoring});this.setState({validSaved:true})}else if(password!==""&&username!==""&&url!==""){script_login({url,username,password}).then((()=>{chrome.storage.local.set({url,password,username,ignoring});this.setState({validSaved:true})})).catch((error=>{this.setState({validSaved:false,errorMsg:error})}))}else{this.setState({validSaved:false,errorMsg:"A required input was empty"})}}))}}));_defineProperty(this,"componentDidMount",(()=>{chrome.storage.local.get(["url","password","username","ignoring"],(({url,password,username,ignoring=[]})=>{this.setState({url,password,username,ignoring:ignoring.join(", ")})}))}))}}class Default extends p{constructor(...args){super(...args);_defineProperty(this,"state",{loading:true,loggedOut:false,noMarks:false,newVersion:false});_defineProperty(this,"render",((_properties,{loggedOut,loading,noMarks,newVersion,average,averageFailing,compDub,compDubFailing,failingAmount,failingAmountFailing,vals,failingVals,amountIsPlural,passingOverall,errorMsg})=>a("div",{class:"margin"},a("div",null,a("button",{class:"btn",onClick:()=>{route("/settings")},type:"button"},"Open settings"),a("hr",null)),newVersion&&a("div",{id:"new-version"},a("a",{href:"https://github.com/melusc/schulNetz-extension/releases/latest",rel:"noopener noreferrer"},"New version available")),loading&&a(y,null,a("div",{class:"loading-outer"},a("div",{class:"loading-inner"})),a("hr",null)),loggedOut&&a("div",null,a("div",null,"You are logged out."),a("div",null,"Login ",a("a",{href:"/settings"},"here"),".")),!loading&&!loggedOut&&!errorMsg&&!noMarks&&a("div",null,a("h3",{class:passingOverall?"passing":"failing"},"Summary:",a("div",null,passingOverall?"Passing":"Failing")),a("hr",null),a("h3",{class:averageFailing?"failing":"passing"},"Average:",a("div",null,average)),a("hr",null),a("h3",{class:compDubFailing?"failing":"passing"},"Compensate double:",a("div",null,compDub)),a("hr",null),a("h3",{class:failingAmountFailing?"failing":"passing"},"Failing in ",failingAmount," course",amountIsPlural?"s":""),a(Table,{vals:failingVals}),Array.isArray(vals)&&a(y,null,a("h3",null,"All marks"),a("div",null,"Amount: ",vals.length),a(Table,{vals}))),noMarks&&a(y,null,a("div",null,"You don't have any marks"),a("hr",null)),errorMsg&&a(y,null,a("div",null,typeof errorMsg==="string"?errorMsg:errorMsg.message),a("hr",null)),a("small",null,chrome.runtime.getManifest().version))));_defineProperty(this,"componentDidMount",(()=>{chrome.storage.local.get(["url","password","username","ignoring"],(({url,password,username,ignoring=[]})=>{if(url&&password&&username){script_login({url,username,password}).then((rows=>{const vals=rows.map((currentRow=>({courseName:currentRow.firstElementChild.lastChild.textContent.trim(),mark:roundMark(currentRow.children[1].textContent),uuid:uuidv4()}))).filter((({courseName})=>!ignoring.includes(courseName.toLowerCase())));if(vals.length<=0){this.setState({loading:false,noMarks:true});return}let avg=0;for(const{mark}of vals){avg+=mark}avg/=vals.length;const average=avg.toFixed(3);const averageFailing=avg<4;let compDub=0;for(const{mark}of vals){compDub+=(mark-4)*(mark<4?2:1)}const compDubFailing=compDub<0;const failingVals=vals.filter((({mark})=>mark<4));const failingAmount=failingVals.length;const failingAmountFailing=failingAmount>3;const amountIsPlural=failingAmount!==1;const passingOverall=!(averageFailing||compDubFailing||failingAmountFailing);console.log("not failed");this.setState({average,averageFailing,compDub,compDubFailing,failingAmount,failingAmountFailing,vals,failingVals,amountIsPlural,passingOverall,loading:false})})).catch((error=>{console.log(error,"1");if(error.message===ERRORS.INCORRECT_CREDS){this.setState({loggedOut:true,loading:false})}else{this.setState({loading:false,errorMsg:error})}}));fetch("https://api.github.com/repos/melusc/schulnetz-extension/releases/latest").then((response=>response.json())).then((responseJSON=>{const newVersion=responseJSON.tag_name;const oldVersion=chrome.runtime.getManifest().version;if(newVersion>oldVersion){this.setState({newVersion:true})}}))}else{this.setState({loggedOut:true,loading:false})}}))}))}}const Table=({vals})=>Array.isArray(vals)&&a("div",{class:"table"},a("div",{class:"thead"},a("div",{class:"tr"},a("div",null,"Course"),a("div",null,"Mark"))),a("div",null,vals.map((({mark,courseName,uuid})=>a("div",{class:"tr",key:uuid},a("div",null,courseName),a("div",null,mark))))));const roundMark=(number=new Error("number is required"))=>{const parsedNumber=Number.parseFloat(number);return Math.round(parsedNumber*2)/2};const uuidv4=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16)));init()})();